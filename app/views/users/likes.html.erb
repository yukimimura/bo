<div class="columns is-centered">
  <div class="column is-7">
    <div class="has-text-centered">
      <% if @user.image? %>
        <img class="" width="200" height="200" src="<%= @user.image.url %>" >
      <% else %>
        <%= image_tag "/assets/default.jpg", :size => '200x200' %>
      <% end %>
    </div>
    
    <p class="is-size-1 has-text-weight-bold has-text-centered"><%= @user.username %></p>
    
    <% if current_user == @user %>
      <p class="has-text-centered"><%= @user.email %></p>
    <% else %>
      <div class="has-text-centered mt-3">
        <%= render 'relationships/follow_button', user: @user %>
      </div>
    <% end %>

    <div class="has-text-centered mt-3">
      <% if current_user == @user %>
        <button class="button">
          <%= link_to edit_user_path(@user) do %>
            <span class="icon">
              <i class="fas fa-user-edit"></i>
            </span>
            <span>編集</span>
          <% end %>
        </button>
      <% end %>
    </div>
  
    <div class="tabs is-centered mt-5">
      <ul>
        <li class="has-text-weight-bold"><a href="<%= user_path(@user) %>" >レビュー</a></li>
        <li class="has-text-weight-bold"><a href="<%= followings_user_path(@user) %>">フォロー</a></li>
        <li class="has-text-weight-bold"><a href="<%= followers_user_path(@user) %>">フォロワー</a></li>
        <li class="is-active has-text-weight-bold"><a href="<%= likes_user_path(@user) %>">お気に入り</a></li>
      </ul>
    </div>
    
    <div class="has-text-centered">
      <div>
        <p class="heading is-active">likes</p>
        <p class="title"><%= @count_likes %></p>
      </div>
    </div>
     
  </div>
</div>


<div class="columns is-centered">
  <div class="column is-6">
    <% @posts.each do |post| %>
    
      <div class="media mb-3">
        
        <%= link_to post_path(post) do %>
          <img class="mr-4 rounded" width="150" height="150" src="<%= post.image.url if post.image? %>" alt="">
        <% end %>
        
        <div class="media-body">
          <p class="is-size-5 has-text-weight-bold"><%= link_to post.title, post_path(post) %></p>
          <p><%= post.author %></p>
          <% post.categories.each do |category| %>
            <p><%= category.name %></p>
          <% end %>
          
          <div class="content average-score">
            <div class="star-rating mb-2">
              <div class="star-rating-front" style="width: <%= post.review_score_percentage %>%">★★★★★</div>
              <div class="star-rating-back">★★★★★</div>
            </div>
            <div class="average-score-display ml-3 pt-2">
              <%= post.avg_score %>点（<%= post.reviews.count %>件のレビュー）
            </div>
          </div>
          
          <p class="">
            <% if user_signed_in? %>
              <% if current_user.already_favorited?(post) %>
                <%= link_to post_favorites_path(post), method: :delete do %>
                  <i class="fas fa-heart" style="color: red;"></i>
                <% end %>
                <span style="color: red;"><%= post.favorites.count %></span>
              <% else %>
                <%= link_to post_favorites_path(post), method: :post do %>
                  <i class="far fa-heart"></i>
                <% end %>
                <%= post.favorites.count %>
              <% end %>
            <% else %>
              <%= link_to new_user_session_path, data: { confirm: 'この機能はログインが必要です。'} do %>
                  <i class="far fa-heart"></i>
                <% end %>
              <%= post.favorites.count %>
            <% end %>
          </p>
        </div>
      </div>
    <% end %>
  </div>
</div>

<% if @posts.count < 10 %>
  <div class="pt-5 columns is-centered">
    <div class="column is-3">
      <%= paginate @posts %>
    </div>
  </div>
<% else %>
  <div class="pt-5 columns is-centered">
    <div class="column is-3">
      <%= paginate @posts %>
    </div>
  </div>
<% end %>